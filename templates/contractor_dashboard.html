<!doctype html>
{% extends "layout.html" %}
{% block title %}My Applications — Dashboard{% endblock %}

{% block content %}
  <div class="card" style="max-width:900px;margin:0 auto;padding:18px;">
    <h2>My Applications</h2>
    <p class="meta" style="color:#666;margin-top:6px;">
      Here are the jobs you applied for.
    </p>

    <hr>

    {% if applications %}
      <ul style="list-style:none;padding:0;margin:0;">
        {% for item in applications %}
          {% set app = item.application %}
          {% set job = item.job %}
          {% set emp = item.employer %}
          <li style="padding:12px 0;border-bottom:1px solid #eee;">
            <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;">
              <div>
                {% if job %}
                  <div style="font-weight:600;font-size:1.05rem;">
                    <a href="{{ url_for('job_detail', job_id=job.id) }}">{{ job.title }}</a>
                  </div>
                  <div class="meta" style="color:#666;margin-top:6px;">
                    {% if emp %}
                      Posted by: {{ emp.username or emp.first_name or emp.email }}
                    {% else %}
                      Posted by: (deleted employer)
                    {% endif %}
                    • Applied: {{ app.created_at|date_only }}
                    {% if job.location_text %}• {{ job.location_text|short_addr }}{% endif %}
                  </div>
                  <div style="margin-top:8px;color:#333;">
                    {{ job.description[:250] }}{% if job.description and job.description|length > 250 %}...{% endif %}
                  </div>
                {% else %}
                  <div style="font-weight:600;">(Job removed)</div>
                  <div class="meta" style="color:#666;margin-top:6px;">
                    Applied: {{ app.created_at|date_only }}
                  </div>
                {% endif %}
              </div>

              <div style="text-align:right;min-width:130px;">
                {% if job %}
                  <a class="btn btn-outline" href="{{ url_for('job_detail', job_id=job.id) }}">View job</a>
                {% endif %}
                <div style="margin-top:8px;color:#666;font-size:0.9rem;">Application ID: {{ app.id }}</div>
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No applications found. Browse <a href="{{ url_for('jobs_list') }}">jobs</a> and apply to ones you like.</p>
    {% endif %}
  </div>
{% endblock %}